---
apiVersion: v1
data:
  logstash.conf: |
    input {
      beats {
        port => "5044"
      }
    }
    output {
      elasticsearch { 
        hosts => ["https://demo-es-http:9200"]
        index => "kube-apiserver-%{+YYYY.MM.dd}"
        cacert => "/usr/share/logstash/config/ca.crt"
        user => 'elastic'
        password => '${ELASTICSEARCH_PASSWORD}'
      }
    }
kind: ConfigMap
metadata:
  name: logstash-pipeline
  labels:
    app: logstash-demo
---
apiVersion: v1
data:
  logstash.yml: |
    api.http.host: "0.0.0.0"
    xpack.monitoring.enabled: true
    xpack.monitoring.elasticsearch.username: 'elastic'
    xpack.monitoring.elasticsearch.password: '${ELASTICSEARCH_PASSWORD}'
    xpack.monitoring.elasticsearch.hosts: ["https://demo-es-http:9200"]
    xpack.monitoring.elasticsearch.ssl.certificate_authority: /usr/share/logstash/config/ca.crt
kind: ConfigMap
metadata:
  name: logstash-config
  labels:
    app: logstash-demo